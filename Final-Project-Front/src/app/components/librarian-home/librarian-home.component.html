<app-nav-bar></app-nav-bar>
<div class="management-container">
  <h1>Catalogue Management</h1>

  <mat-card-header>
    <mat-card-title>Create book register</mat-card-title>
    <button [routerLink]="['/register-book']"
            mat-mini-fab color="accent">
      <mat-icon>plus_one</mat-icon>
    </button>
  </mat-card-header>

  <mat-card-header>
    <mat-card-title>Delete book register</mat-card-title>
    <button (click)="openDeleteBook()"
            mat-mini-fab color="accent">
      <mat-icon>delete</mat-icon>
    </button>
  </mat-card-header>
  <div class="delete" *ngIf="goDelete">
    <form (ngSubmit)="deleteBook()" [formGroup]="bookForm">

      <mat-card-content>
        <mat-form-field class="full-width" appearance="outline">
          <mat-label>EAN</mat-label>
          <input type="number" matInput formControlName="ean" placeholder="EAN">
          <mat-error *ngIf="eanToDeleteInput.hasError('required') && eanToDeleteInput.touched">
            EAN is required
          </mat-error>
        </mat-form-field>

        <div class="buttons">
          <button type="button" [disabled]="bookForm.invalid" mat-raised-button color="accent" class="full-width"
                  (click)="deleteBook()"
          >Submit

          </button>
          <button mat-raised-button color="warn" class="full-width"
                  (click)="goBack()">Close
          </button>
        </div>
      </mat-card-content>

    </form>
  </div>


<!--  <mat-card-header>-->
<!--    <mat-card-title>Create loaned book register</mat-card-title>-->
<!--    <button (click)="openCreateLoanedBookRegister()"-->
<!--            mat-mini-fab color="accent">-->
<!--      <mat-icon>plus_one</mat-icon>-->
<!--    </button>-->
<!--  </mat-card-header>-->

<!--  <div class="create-loaned" *ngIf="goCreateLoanedBookRegister">-->
<!--    <form (ngSubmit)="createLoanedBookRegister()" [formGroup]="bookForm">-->
<!--      <mat-card-content>-->
<!--        <mat-form-field class="full-width" appearance="outline">-->
<!--          <mat-label>EAN</mat-label>-->
<!--          <input type="number" matInput formControlName="ean" placeholder="EAN">-->
<!--          <mat-error *ngIf="eanToDeleteInput.hasError('required') && eanToDeleteInput.touched">-->
<!--            EAN is required-->
<!--          </mat-error>-->
<!--        </mat-form-field>-->

<!--        <div class="buttons">-->
<!--          <button type="button" [disabled]="bookForm.invalid" mat-raised-button color="accent" class="full-width"-->
<!--                  (click)="createLoanedBookRegister()"-->
<!--          >Submit-->

<!--          </button>-->
<!--          <button mat-raised-button color="warn" class="full-width"-->
<!--                  (click)="goBack()">Close-->
<!--          </button>-->
<!--        </div>-->
<!--      </mat-card-content>-->

<!--    </form>-->
<!--  </div>-->

</div>


<!--borrowed books management-->

<div class="management-container">
  <h1>Borrowed Books Management</h1>

  <mat-card-header>
    <mat-card-title>Find loaned book register</mat-card-title>
    <button (click)="findSingleLoanedBook()"
            mat-mini-fab color="accent">
      <mat-icon>lens</mat-icon>
    </button>
  </mat-card-header>

  <div class="create-loaned" *ngIf="goFindSingleLoanedBook">
    <form (ngSubmit)="showSingleBook()" [formGroup]="bookForm">
      <mat-card-content>
        <mat-form-field class="full-width" appearance="outline">
          <mat-label>EAN</mat-label>
          <input type="number" matInput formControlName="ean" placeholder="EAN">
          <mat-error *ngIf="eanToDeleteInput.hasError('required') && eanToDeleteInput.touched">
            EAN is required
          </mat-error>
        </mat-form-field>

        <div class="buttons">
          <button type="button" [disabled]="bookForm.invalid" mat-raised-button color="accent" class="full-width"
                  (click)="showSingleBook()"
          >Submit

          </button>
          <button mat-raised-button color="warn" class="full-width"
                  (click)="goBack()">Close
          </button>
        </div>
      </mat-card-content>

    </form>

    <div *ngIf="showBook">
      <div *ngFor="let singleBook of singleLoanedBook">
      <p>State {{singleBook.loanState}}</p>
      <p>Recogido {{singleBook.pickedUp}}</p>
      <p>LoanDate {{this.singleBook.loanDate}}</p>
      <p>Return {{this.singleBook.returnDate}}</p>
      <p>UserId {{this.singleBook.userId}}</p>
      </div>
    </div>


  </div>

  <mat-card-header>
    <mat-card-title>Book LOST</mat-card-title>
    <button (click)="changeOneStatus()"
            mat-mini-fab color="accent">
      <mat-icon>cached</mat-icon>
    </button>
  </mat-card-header>
  <div class="create-loaned" *ngIf="goChangeStatus">
    <form (ngSubmit)="changeStatus()" [formGroup]="bookForm">
      <mat-card-content>
        <mat-form-field class="full-width" appearance="outline">
          <mat-label>EAN</mat-label>
          <input type="number" matInput formControlName="ean" placeholder="EAN">
          <mat-error *ngIf="eanToDeleteInput.hasError('required') && eanToDeleteInput.touched">
            EAN is required
          </mat-error>
        </mat-form-field>

        <div class="buttons">
          <button type="button" [disabled]="bookForm.invalid" mat-raised-button color="accent" class="full-width"
                  (click)="changeStatus()"
          >Submit
          </button>
          <button mat-raised-button color="warn" class="full-width"
                  (click)="goBack()">Close
          </button>
        </div>
      </mat-card-content>

    </form>
  </div>


  <mat-card-header>
    <mat-card-title>Registers of Books</mat-card-title>
    <button (click)="showAllLoanedBooks()" (click)="increaseCounter()"
            mat-mini-fab color="accent">
      <mat-icon>line_weight</mat-icon>
    </button>
  </mat-card-header>
  <mat-card-content class="registers">
    <div *ngIf="isAllLoanedBook">
      <div class="registers-items-for" *ngFor="let loanedBook of allLoanedBooks | paginate: { itemsPerPage: 5, currentPage: page,
    totalItems: totalAllLoanedBooks}">
        <!--        <p>Loaned book id: {{loanedBook.loanedBookId}}</p>-->
        <p>User ID: {{loanedBook.userId}}</p>
        <p>Ean: {{loanedBook.ean}}</p>
        <p [ngClass]="{'overdue': loanedBook.loanState==='OVERDUE'}">State: {{loanedBook.loanState}}</p>
        <p>Recogido: {{loanedBook.pickedUp}}</p>

        <!--        <p>Loan date: {{loanedBook.loanDate}}</p>-->
        <!--        <p>Return date: {{loanedBook.returnDate}}</p>-->
      </div>
      <pagination-controls class="paginator"
                           (pageChange)="page = $event; allLoanedBooks = []; showAllLoanedBooksPag()"></pagination-controls>
    </div>

  </mat-card-content>


  <mat-card-header>
    <mat-card-title>Loaned Books</mat-card-title>
    <button (click)="showLoanedBooks()" (click)="increaseCounter()"
            mat-mini-fab color="accent">
      <mat-icon>nature_people</mat-icon>
    </button>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="isLoanedBook">
      <div *ngFor="let loanedBook of loanedBooks | paginate: { itemsPerPage: 5, currentPage: page,
    totalItems: totalLoanedBooks};  let i =index ">
        <mat-card>
          <mat-card-title>Ean: {{loanedBook.ean}}</mat-card-title>
          <mat-card-subtitle>State: {{loanedBook.loanState}}</mat-card-subtitle>
          <mat-card-content>User ID: {{loanedBook.userId}}</mat-card-content>
          <mat-card-content>Loan date: {{loanedBook.loanDate}}</mat-card-content>
          <mat-card-content>Return date: {{loanedBook.returnDate}}</mat-card-content>
          <mat-card-content>Picked Up: {{loanedBook.pickedUp}}</mat-card-content>

          <button (click)="updatePickUpLoanedBook(loanedBook.ean)">Pick Up</button>
          <button (click)="returnBook(loanedBook.ean)">Return</button>
        </mat-card>
      </div>
      <pagination-controls
        (pageChange)="page = $event; loanedBooks = []; showLoanedBooksPag()"></pagination-controls>
    </div>
  </mat-card-content>


  <mat-card-header>
    <mat-card-title>Overdue Books</mat-card-title>
    <button (click)="showOverdueBooks()" (click)="increaseCounter()"
            mat-mini-fab color="accent">
      <mat-icon>hourglass_empty</mat-icon>
    </button>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="isOverdueBook">
      <div *ngFor="let overdueBook of overdueBooks | paginate: { itemsPerPage: 5, currentPage: page,
    totalItems: totalOverdueBooks}">
        <mat-card>
          <mat-card-title>Ean: {{overdueBook.ean}}</mat-card-title>
          <mat-card-subtitle>State: {{overdueBook.loanState}}</mat-card-subtitle>
          <mat-card-content>User ID: {{overdueBook.userId}}</mat-card-content>
          <mat-card-content>Loan date: {{overdueBook.loanDate}}</mat-card-content>
          <mat-card-content>Return date: {{overdueBook.returnDate}}</mat-card-content>

          <button (click)="returnBook(overdueBook.ean)">Return</button>
        </mat-card>
      </div>
      <pagination-controls
        (pageChange)="page = $event; overdueBooks = []; showOverdueBooksPag()"></pagination-controls>
    </div>
  </mat-card-content>


  <mat-card-header>
    <mat-card-title>Available Books</mat-card-title>
    <button (click)="showAvailableBooks()" (click)="increaseCounter()"
            mat-mini-fab color="accent">
      <mat-icon>book</mat-icon>
    </button>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="isAvailableBook">
      <div *ngFor="let availableBook of availableBooks | paginate: { itemsPerPage: 5, currentPage: page,
    totalItems: totalAvailableBooks }">
        <mat-card>
          <mat-card-title>Ean: {{availableBook.ean}}</mat-card-title>
          <mat-card-subtitle>State: {{availableBook.loanState}}</mat-card-subtitle>
        </mat-card>
      </div>
      <!--      <mat-paginator [length]="100"
                           [pageSize]="10"
                           [pageSizeOptions]="[5, 10, 25, 100]"
                           aria-label="Select page">
            </mat-paginator>-->
      <pagination-controls
        (pageChange)="page = $event; availableBooks = []; showAvailableBooksPag()"></pagination-controls>
    </div>
  </mat-card-content>


  <mat-card-header>
    <mat-card-title>Lost Books</mat-card-title>
    <button (click)="showLostBooks()" (click)="increaseCounter()"
            mat-mini-fab color="accent">
      <mat-icon>error</mat-icon>
    </button>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="isLostBook">
      <div *ngFor="let lostBook of lostBooks | paginate: { itemsPerPage: 5, currentPage: page,
    totalItems: totalLostBooks}">
        <mat-card>
          <!--          <mat-card-header>Title: {{showTitle(lostBook.ean)}}</mat-card-header>-->
          <mat-card-title>Ean: {{lostBook.ean}}</mat-card-title>
          <mat-card-subtitle>State: {{lostBook.loanState}}</mat-card-subtitle>
          <mat-card-content>User ID: {{lostBook.userId}}</mat-card-content>
          <mat-card-content>Loan date: {{lostBook.loanDate}}</mat-card-content>
          <mat-card-content>Return date: {{lostBook.returnDate}}</mat-card-content>
        </mat-card>
      </div>
      <pagination-controls
        (pageChange)="page = $event; lostBooks = []; showLostBooksPag()"></pagination-controls>
    </div>
  </mat-card-content>
</div>

<div class="management-container">
  <h1>User Management</h1>

  <mat-card-header>
    <mat-card-title>Show users</mat-card-title>
    <button (click)="showUsers()" (click)="increaseCounter()"
            mat-mini-fab color="accent">
      <mat-icon>people</mat-icon>
    </button>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="isShowUser">
      <div *ngFor="let user of userList">
        <mat-card>
          <p>User ID: {{user.id}}</p>
          <p>Name: {{user.username}}</p>
        </mat-card>
      </div>

    </div>
  </mat-card-content>
</div>

